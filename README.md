# ControlSystem — Микросервисная архитектура

Учебная микросервисная система для управления пользователями и заказами.

Система состоит из трёх независимых сервисов:

* **API Gateway** — единая точка входа, управление безопасностью и логированием
* **Users Service** — управление пользователями, авторизация, роли, профиль
* **Orders Service** — создание и управление заказами

Все сервисы взаимодействуют по HTTP и разворачиваются через **Docker Compose**.

---

## Технологии

* **Node.js + Express** — все сервисы
* **JWT** — авторизация
* **Axios** — внутренняя прокси-коммуникация между сервисами
* **Pino** — структурированное логирование (Request ID)
* **Rate Limit** — защита от спама и brute-force
* **Docker Compose** — запуск всей системы
* **OpenAPI 3.0** — документация API

---

## Структура проекта

```
/
├── gateway/
│   ├── index.js
│   └── ...
├── users-service/
│   ├── index.js
│   └── ...
├── orders-service/
│   ├── index.js
│   └── ...
├── docker-compose.yml
└── README.md
```

---

## Запуск проекта

1. Установите [Docker и Docker Compose](https://www.docker.com/products/docker-desktop/)
2. Запустите все сервисы командой:

```bash
docker-compose up --build
```

---

## Users Service

**Основные функции:**

* Регистрация пользователей
* Вход и генерация JWT
* Просмотр и обновление профиля
* Получение списка пользователей (только для admin)

**Маршруты:**

| Метод | Путь           | Описание                          |
| ----- | -------------- | --------------------------------- |
| POST  | /auth/register | Регистрация пользователя          |
| POST  | /auth/login    | Вход и генерация JWT              |
| GET   | /users/profile | Получение профиля                 |
| PUT   | /users/profile | Обновление профиля                |
| GET   | /users         | Список всех пользователей (admin) |

---

## Orders Service

**Основные функции:**

* Создание заказов
* Получение списка заказов (только свои, admin — все)
* Изменение статуса заказа
* Удвление заказа

**Статусы заказов:**

```
created → in_progress → completed → cancelled
```

---

## API Gateway

**Отвечает за:**

* Проверку и валидацию JWT
* Rate limiting
* Логирование через Pino
* Проксирование запросов к Users и Orders
* Единый формат ошибок

**Формат ответа:**

* **Успех:**

```json
{
  "success": true,
  "data": { ... }
}
```

* **Ошибка:**

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Описание ошибки"
  }
}
```

---

## Healthcheck

**Проверка состояния системы:**

* **GET** `/health`

**Пример ответа:**

```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "services": {
      "gateway": "ok",
      "users": "ok",
      "orders": "ok"
    }
  }
}
```

